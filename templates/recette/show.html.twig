{% extends 'base.html.twig' %}

{% block title %}Recette | {{ recette.titre }}{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block body %}
<header class="bg-[#2e2e2e] shadow-md">
    <div class="container mx-auto flex items-center justify-between p-4 flex-wrap">
        <div class="flex-shrink-0">
            <a href="{{ path('app_accueil') }}">
                <img src="{{ asset('images/cooksy_logo.png') }}" alt="Cooksy Logo" class="h-20 w-auto">
            </a>
        </div>
        <div class="relative flex-grow mx-auto max-w-lg order-last md:order-none w-full md:w-auto mt-4 md:mt-0">
            <input type="search" placeholder="Que faisons-nous aujourd'hui ?" class="w-full px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-orange-500 transition duration-300 placeholder-white">
            <button type="submit" class="absolute right-0 top-0 mt-2 mr-4 text-gray-500">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        <div class="flex space-x-2 md:space-x-4">
        {# KullanÄ±cÄ± giriÅŸ yaptÄ±ysa, profil avatarÄ±nÄ± ve Ã§Ä±kÄ±ÅŸ yap baÄŸlantÄ±sÄ±nÄ± gÃ¶ster #}
        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
            <div class="user-info flex items-center space-x-2">
                        <a href="{{ path('app_profil') }}" class="flex-col flex items-center text-gray-200 hover:text-orange-600 font-medium">
                        {% if app.user.image %}
                            <img src="{{ asset('uploads/' ~ app.user.image) }}" alt="Profil Photo" class="profile-avatar w-[76px] h-[76px]">
                        {% else %}
                            <img src="https://placehold.co/32x32/E0E0E0/FFFFFF?text=P" alt="VarsayÄ±lan Profil Resmi" class="profile-avatar w-[76px] h-[76px] border-2 border-orange-500">
                        {% endif %}
                        
                        <span>{{ app.user.nom }}</span>
                        </a>

                        <div class="flex flex-col items-center space-y-4 ml-6 relative">
                        {# ADMIN PANEL LÄ°NKÄ° â€” sadece adminlere gÃ¶rÃ¼nÃ¼r #}
                        {% if is_granted('ROLE_ADMIN') %}
                                <a href="{{ path('app_admin_index') }}" class="relative group">
                                    <i class="fa-solid fa-gear text-blue-500 text-3xl"></i>
                                    <span class="absolute top-1/2 left-[-270px] translate-x-1/2 mt-2 px-2 py-1 bg-yellow-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-50 whitespace-nowrap shadow-md">
                                        Panneau dâ€™administration
                                    </span>
                                </a>
                            {% endif %}

                        <a href="{{ path('app_logout') }}" class="relative group">
                            
                            <i class="fa-solid fa-right-from-bracket text-red-500 text-3xl"></i>
                            <span class="absolute left-[10px] top-1/2 -translate-x-1/2 mt-2 px-2 py-1 bg-yellow-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-50 whitespace-nowrap shadow-md">Se dÃ©connecter</span>
                        </a>
                    </div>
        {# KullanÄ±cÄ± giriÅŸ yapmadÄ±ysa, giriÅŸ ve kayÄ±t linklerini gÃ¶ster #}
        {% else %}
            <a href="{{ path('app_login') }}" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-full transition duration-300 transform hover:scale-105 shadow-md">Se connecter</a>
            <a href="{{ path('app_register') }}" class="bg-orange-100 text-orange-600 font-semibold py-2 px-4 rounded-full border border-orange-500 hover:bg-orange-200 transition duration-300 transform hover:scale-105 shadow-md">S'inscrire</a>
        {% endif %}
    </div>
    </div>
</header>
<nav class="bg-gray-300 shadow-sm p-4 relative">
        <div class="container mx-auto flex justify-between items-center">
            <div class="hidden md:!flex space-x-6 justify-center items-center w-full">
                <a href="{{ path('app_recette_index') }}" class="{% if app.request.attributes.get('_route') == 'app_recette_index' %}text-orange-600{% else %}text-gray-700 hover:text-orange-600{% endif %} font-semibold transition duration-300">Recettes</a>
                <a href="{{ path('app_cuisines_index') }}" class="{% if app.request.attributes.get('_route') == 'app_cuisines_index' %}text-orange-600{% else %}text-gray-700 hover:text-orange-600{% endif %} font-semibold transition duration-300">Cuisines</a>
                <a href="{{ path('app_astuces_index') }}" class="{% if app.request.attributes.get('_route') == 'app_astuces_index' %}text-orange-600{% else %}text-gray-700 hover:text-orange-600{% endif %} font-semibold transition duration-300">Astuces</a>
                <a href="{{ path('app_about_index') }}" class="{% if app.request.attributes.get('_route') == 'app_about_index' %}text-orange-600{% else %}text-gray-700 hover:text-orange-600{% endif %} font-semibold transition duration-300">Ã€ propos</a>
                <a href="{{ path('app_contact_index') }}" class="{% if app.request.attributes.get('_route') == 'app_contact_index' %}text-orange-600{% else %}text-gray-700 hover:text-orange-600{% endif %} font-semibold transition duration-300">Contact</a>
            </div>

         <!-- Burger MenÃ¼ Butonu (sadece mobilde) -->
            <div class="relative md:hidden ml-auto group">
                <button id="burger-btn" class="md:hidden ml-auto text-gray-700 text-2xl focus:outline-none cursor-pointer">
                    <i class="fas fa-bars"></i>
                </button>
    

    <!-- Mobile MenÃ¼: KonumlandÄ±rma sorununu gidermek iÃ§in bu div'i ana nav div'inin dÄ±ÅŸÄ±na taÅŸÄ±dÄ±k. -->
                <div id="mobile-menu" class="hidden group-hover:flex absolute right-0 top-full mt-2 bg-white shadow-lg rounded-md flex-col space-y-2 p-3 w-40 z-50">
                    <a href="{{ path('app_recette_index') }}" class="text-gray-700 hover:bg-gray-100 p-2 rounded block">Recettes</a>
                    <a href="{{ path('app_cuisines_index') }}" class="text-gray-700 hover:bg-gray-100 p-2 rounded block">Cuisines</a>
                    <a href="{{ path('app_astuces_index') }}" class="text-gray-700 hover:bg-gray-100 p-2 rounded block">Astuces</a>
                    <a href="{{ path('app_about_index') }}" class="text-gray-700 hover:bg-gray-100 p-2 rounded block">Ã€ propos</a>
                    <a href="{{ path('app_contact_index') }}" class="text-gray-700 hover:bg-gray-100 p-2 rounded block">Contact</a>
                </div>
            </div>
        </div>
    </nav>

<main class="container">
    <div class="bg-[#FF7043] shadow-xl overflow-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Tarif GÃ¶rseli -->
            <div class="relative overflow-auto w-full h-auto">
                {% if recette.image is not null %}
                    <img src="{{ asset('uploads/recettes/' ~ recette.image) }}" 
                        alt="{{ recette.titre }}" 
                        class="w-[95%] h-[650px] object-cover rounded-2xl mx-auto my-3">
                {% endif %}

                {% if app.user %}
        {# BeÄŸeni durumunu kontrol et: KullanÄ±cÄ± tarifi beÄŸenmiÅŸ mi? #}
        {% set isLiked = recette.likes.contains(app.user) %}
        
            <button 
                id="likeButton" 
                data-recette-id="{{ recette.id }}" 
                data-like-url="{{ path('recette_like', {'id': recette.id}) }}"
                class="absolute top-6 right-8 bg-black bg-opacity-50 text-white py-1 px-2 rounded-lg flex items-center space-x-1 cursor-pointer transition duration-200 hover:bg-opacity-70"
                title="J'aime / Je n'aime pas"
            >
                <i id="likeIcon" 
                class="fas fa-heart text-xl transition-colors duration-200 
                {# BeÄŸenme durumuna gÃ¶re renk atamasÄ± #}
                {% if isLiked %}text-red-500{% else %}text-white{% endif %}">
                </i>
                <span id="likesCount" class="text-xl font-bold">
                    {{ recette.likes|length }}
                </span>
            </button>

    {% else %}
        {# GiriÅŸ yapmamÄ±ÅŸ kullanÄ±cÄ±lar iÃ§in sadece gÃ¶sterim #}
        <div class="absolute top-6 right-8 bg-black bg-opacity-50 text-white py-1 px-2 rounded-lg flex items-center space-x-1">
            <i class="fas fa-heart text-xl text-white"></i>
            <span class="text-xl font-bold">{{ recette.likes|length }}</span>
        </div>
    {% endif %}

                <div class=" p-1 flex items-center justify-between mb-8 ml-auto w-fit">
                <div class="flex items-center space-x-2">
                    {% set totalRating = 0 %}
                    {% set ratingCount = 0 %}
                    {% for commentaire in commentaires %}
                        {% if commentaire.note is not null %}
                            {% set totalRating = totalRating + commentaire.note %}
                            {% set ratingCount = ratingCount + 1 %}
                        {% endif %}
                    {% endfor %}
                    {% set averageRating = ratingCount > 0 ? (totalRating / ratingCount)|round(1) : 0 %}
                    <span class="text-yellow-400 text-xl">
                        {#
                            Bu dÃ¶ngÃ¼, toplamda 5 yÄ±ldÄ±za ulaÅŸana kadar
                            her bir yÄ±ldÄ±za hangi sÄ±nÄ±fÄ± (tam, yarÄ±m, boÅŸ)
                            vereceÄŸine karar veriyor.
                        #}
                        {% for i in 1..5 %}
                            {% if averageRating >= i %}
                                {# Tam yÄ±ldÄ±z #}
                                <i class="fas fa-star"></i>
                            {% elseif averageRating > i - 1 and averageRating < i %}
                                {# YarÄ±m yÄ±ldÄ±z #}
                                <i class="fas fa-star-half-alt"></i>
                            {% else %}
                                {# BoÅŸ yÄ±ldÄ±z #}
                                <i class="far fa-star text-gray-400"></i>
                            {% endif %}
                        {% endfor %}
                    </span>
                    <span class="text-gray-700 font-medium">
                        {{ averageRating }} / 5 ({{ ratingCount }} votes)
                    </span>
                </div>
            </div>

                <div class="container mx-auto">
                <div class="px-4 py-4 md:px-6 md:py-6">
                <!-- Tarif BaÅŸlÄ±ÄŸÄ± ve Yazar -->
                    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-2">{{ recette.titre }}</h1>
                    <p class="text-xl text-gray-600 mb-4">par <span class="text-xl font-bold text-black">{{ recette.auteur.nom }}</span></p>

                    <hr class="my-4">
                
                    <!-- SÃ¼reler ve ikonlar -->
                    <div class="flex flex-wrap items-center space-x-4 mb-6">
                        <div class="flex items-center space-x-1">
                            <span class="text-2xl text-orange-500">â³</span>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">PrÃ©paration</h3>
                                <p class="text-gray-600">{{ recette.tempPreparation }} min</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-2xl text-orange-500">ğŸ”¥</span>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">Cuisson</h3>
                                <p class="text-gray-600">{{ recette.tempCuisson }} min</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-2xl text-orange-500">â±ï¸</span>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">Total</h3>
                                <p class="text-gray-600 font-bold">{{ recette.tempPreparation + recette.tempCuisson }} min</p>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">
                        <!-- Tarif aÃ§Ä±klamasÄ± -->
                        <div class="mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Description</h2>
                            <p class="text-gray-700 leading-relaxed">{{ recette.description }}</p>
                        </div>
                </div>
                </div>
            </div>
            
            <!-- Tarif DetaylarÄ± -->
            <div class="p-6 md:p-8 w-full lg:w-full">
                

                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">IngrÃ©dients</h2>
                    <p class="text-gray-700 leading-relaxed whitespace-pre-wrap">{{ recette.ingredients }}</p>
                </div>

                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Ã‰tapes</h2>
                    <p class="text-gray-700 leading-relaxed whitespace-pre-wrap">{{ recette.etapes }}</p>
                </div>

                <div class="flex flex-col space-y-3 mt-8">
    
                    {# 1. Retour Ã  la liste #}
                    <a href="{{ path('app_recette_index') }}" class="w-full text-center bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-xl hover:bg-gray-300 transition duration-300 transform hover:scale-[1.02] shadow-sm">
                        <i class="fas fa-arrow-left mr-2"></i> Retour Ã  la liste
                    </a>
                    
                    {% if is_granted('ROLE_ADMIN') or app.user == recette.auteur %}
                        
                        {# 2. Modifier #}
                        <a href="{{ path('app_recette_edit', {'id': recette.id}) }}" class="w-full text-center bg-orange-500 text-white font-semibold py-3 px-6 rounded-xl hover:bg-orange-600 transition duration-300 transform hover:scale-[1.02] shadow-lg shadow-orange-500/50">
                            <i class="fas fa-edit mr-2"></i> Modifier
                        </a>
                        
                        {# 3. Supprimer (Buton) #}
                        <button type="button" onclick="showDeleteModal()" class="w-full text-center bg-red-500 text-white font-semibold py-3 px-6 rounded-xl hover:bg-red-600 transition duration-300 transform hover:scale-[1.02] shadow-lg shadow-red-500/50 cursor-pointer">
                            <i class="fas fa-trash-alt mr-2"></i> Supprimer
                        </button>
                        
                        {# Formulaire de suppression (Gizli) #}
                        <form id="deleteForm" action="{{ path('app_recette_delete', {'id': recette.id}) }}" method="POST" style="display: none;">
                            <input type="hidden" name="_method" value="DELETE">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ recette.id) }}">
                        </form>
                        
                    {% endif %}
            </div>
            </div>
        </div>

        <!-- Yorumlar ve Not BÃ¶lÃ¼mÃ¼ -->
        <div class="bg-[#FF7043] p-6 md:p-8">
            <!-- Ortalama Not -->
            

            <!-- Yorumlar -->
            <div>
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-between">
                    <span>Commentaires ({{ commentaires|length }})</span>
                </h2>

                <!-- Yorum Yazma Formu -->
                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                    <div class="mb-6 bg-gray-50 p-4 rounded-lg shadow-md">
                        <p class="mb-2 text-sm text-gray-600">
                            Commentez et donnez une note avec votre nom d'utilisateur :
                            <span class="font-semibold text-orange-600">{{ app.user.nom }}</span>
                        </p>
                        <form action="{{ path('app_commentaire_add', {'id': recette.id}) }}" method="POST">
                            <div class="flex items-center space-x-1 mb-4">
                                <span class="text-gray-700 font-medium">Votre note:</span>
                                <div id="star-rating" class="flex items-center space-x-1">
                                    <i class="fa-regular fa-star text-2xl text-gray-400 cursor-pointer hover:text-orange-500 transition-colors duration-200" data-value="1"></i>
                                    <i class="fa-regular fa-star text-2xl text-gray-400 cursor-pointer hover:text-orange-500 transition-colors duration-200" data-value="2"></i>
                                    <i class="fa-regular fa-star text-2xl text-gray-400 cursor-pointer hover:text-orange-500 transition-colors duration-200" data-value="3"></i>
                                    <i class="fa-regular fa-star text-2xl text-gray-400 cursor-pointer hover:text-orange-500 transition-colors duration-200" data-value="4"></i>
                                    <i class="fa-regular fa-star text-2xl text-gray-400 cursor-pointer hover:text-orange-500 transition-colors duration-200" data-value="5"></i>
                                </div>
                                <input type="hidden" name="note" id="note-input" value="">
                            </div>
                            <textarea name="contenu" rows="3"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"
                                        placeholder="Ã‰crivez votre commentaire..."></textarea>
                            <div class="flex justify-end mt-auto">
                                <button type="submit"
                                    class="bg-orange-500 text-white px-6 py-2 rounded-full hover:bg-orange-900 transition duration-300 cursor-pointer">
                                    Envoyer
                                </button>
                            </div>
                        </form>
                    </div>
                {% else %}
                    <p class="text-gray-600 mb-6">ğŸ‘‰ <a href="{{ path('app_login') }}" 
                    class="text-orange-600 hover:underline">Connectez-vous</a> pour commenter.</p>
                {% endif %}

                <!-- Yorum Listesi -->
                <div class="space-y-4">
                    {% for commentaire in commentaires %}
                        <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="font-semibold text-gray-800">{{ commentaire.utilisateur.nom }}</span>
                                    {% if commentaire.note is not null %}
                                        <div class="text-yellow-400">
                                            {% for i in 1..commentaire.note %}
                                                <i class="fas fa-star"></i>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <span class="text-sm text-gray-500">{{ commentaire.createdAt|date('d/m/Y H:i') }}</span>
                            </div>
                            <p class="text-gray-700">{{ commentaire.contenu }}</p>
                        </div>
                    {% else %}
                        <p class="text-gray-600 italic">Aucun commentaire pour le moment.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Onay ModalÄ± -->
<div id="deleteModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg p-6 w-96 max-w-full shadow-lg">
        <div class="text-center">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Confirmation de suppression</h3>
            <p class="text-gray-600 mb-6">ÃŠtes-vous sÃ»r de vouloir supprimer cette recette ? Cette action est irrÃ©versible.</p>
            <div class="flex justify-center space-x-4">
                <button type="button" onclick="hideDeleteModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-full transition duration-300">
                    Annuler
                </button>
                <button type="button" onclick="confirmDelete()" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-full transition duration-300">
                    Supprimer
                </button>
            </div>
        </div>
    </div>
</div>

<footer class="bg-[#2e2e2e] text-white py-8 mt-10">
<div class="container mx-auto px-4">
<!-- MenÃ¼ -->
    <div class="flex justify-center space-x-4 mb-6">
            <a href="{{ path('app_recette_index') }}" class="hover:text-orange-500 transition duration-300">Recettes</a>
            <a href="{{ path('app_cuisines_index') }}" class="hover:text-orange-500 transition duration-300">Cuisines</a>
            <a href="{{ path('app_astuces_index') }}" class="hover:text-orange-500 transition duration-300">Astuces</a>
            <a href="{{ path('app_about_index') }}" class="hover:text-orange-500 transition duration-300">Ã€ propos</a>
            <a href="{{ path('app_contact_index') }}" class="hover:text-orange-500 transition duration-300">Contact</a>
        </div>

    <hr class="border-gray-700 mb-6">

    <!-- Logo, Slogan ve Sosyal Medya Ä°konlarÄ± -->
    <div class="flex md:flex-row items-center justify-between mb-6">
        <div class="flex-1 text-center md:text-left">
            <img src="{{ asset('images/cooksy_logo.png') }}" alt="Cooksy Logo" class="h-16 mx-auto md:mx-0">
            <p class="text-sm mt-2 text-gray-400">Cooksy â€” Partagez vos recettes prÃ©fÃ©rÃ©es ğŸ²</p>
        </div>
        <div class="flex-1 flex justify-center md:justify-end space-x-4 mt-4 md:mt-0">
            <a href="https://www.facebook.com" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-orange-500 transition duration-300">
                <i class="fab fa-facebook-f text-2xl"></i>
            </a>
            <a href="https://www.instagram.com" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-orange-500 transition duration-300">
                <i class="fab fa-instagram text-2xl"></i>
            </a>
            <a href="https://www.youtube.com" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-orange-500 transition duration-300">
                <i class="fab fa-youtube text-2xl"></i>
            </a>
            <a href="https://www.tiktok.com" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-orange-500 transition duration-300">
                <i class="fab fa-tiktok text-2xl"></i>
            </a>
        </div>
    </div>

    <!-- Telif HakkÄ± Metni -->
    <div class="text-center text-gray-500 text-sm">
        Â© 2025 Cooksy. Tous droits rÃ©servÃ©s.
    </div>
</div>

</footer>

<script>
alert('coucou1');
    function showDeleteModal() {
        document.getElementById('deleteModal').classList.remove('hidden');
    }

    function hideDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
    }

    function confirmDelete() {
        document.getElementById('deleteForm').submit();
    }

    const starContainer = document.getElementById('star-rating');
    const stars = starContainer.querySelectorAll('i');
    const noteInput = document.getElementById('note-input');
    let currentRating = 0;

    function fillStars(rating) {
        stars.forEach(star => {
            const starValue = parseInt(star.dataset.value);
            if (starValue <= rating) {
                star.classList.add('fas', 'text-yellow-400');
                star.classList.remove('far', 'text-gray-400');
            } else {
                star.classList.add('far', 'text-gray-400');
                star.classList.remove('fas', 'text-yellow-400');
            }
        });
    }

    starContainer.addEventListener('mouseover', (e) => {
        if (e.target.tagName === 'I') {
            const hoverValue = parseInt(e.target.dataset.value);
            fillStars(hoverValue);
        }
    });

    starContainer.addEventListener('mouseout', () => {
        fillStars(currentRating);
    });

    starContainer.addEventListener('click', (e) => {
        alert('coucou');
        if (e.target.tagName === 'I') {
            currentRating = parseInt(e.target.dataset.value);
            noteInput.value = currentRating;
            fillStars(currentRating);
        }
    });


const burgerBtn = document.getElementById("burger-btn");
const mobileMenu = document.getElementById("mobile-menu");

// MenÃ¼ aÃ§/kapa
burgerBtn.addEventListener("mouseover", (event) => {
    event.stopPropagation();
    mobileMenu.classList.remove("hidden");
});

document.addEventListener("click", (event) => {
    const isMenuVisible = !mobileMenu.classList.contains("hidden");
    
    if(isMenuVisible && !burgerBtn.contains(event.target) && !mobileMenu.contains(event.target)) {
        mobileMenu.classList.add("hidden");
    }
});

// Ekran geniÅŸleyince (md ve Ã¼stÃ¼) mobil menÃ¼yÃ¼ otomatik kapat
window.addEventListener("resize", () => {
  if (window.innerWidth >= 768) {
    mobileMenu.classList.add("hidden");
  }
});

document.addEventListener('DOMContentLoaded', () => {
    const likeButton = document.getElementById('likeButton');
    const likesCountSpan = document.getElementById('likesCount');
    const likeIcon = document.getElementById('likeIcon'); // Ikonu seÃ§tik

    if (likeButton) {
        likeButton.addEventListener('click', async () => {
            const url = likeButton.dataset.likeUrl;
            
            // TÄ±klamayÄ± anlÄ±k olarak devre dÄ±ÅŸÄ± bÄ±rak (Ã‡ift tÄ±klamayÄ± engellemek iÃ§in)
            likeButton.disabled = true;

            try {
                // AJAX isteÄŸi baÅŸlat
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.status === 403) {
                    alert('Vous devez Ãªtre connectÃ© pour effectuer cette action.');
                    likeButton.disabled = false;
                    return;
                }

                if (!response.ok) {
                    throw new Error(`HTTP Hata! Durum: ${response.status}`);
                }

                const data = await response.json();
                
                // BeÄŸeni sayÄ±sÄ±nÄ± gÃ¼ncelle
                likesCountSpan.textContent = data.likesCount;

                if (data.isLiked) {
                    // BeÄŸenildi: Ä°konu KÄ±rmÄ±zÄ± yap
                    likeIcon.classList.remove('text-white');
                    likeIcon.classList.add('text-red-500');
                } else {
                    // BeÄŸeni KaldÄ±rÄ±ldÄ±: Ä°konu Beyaz yap
                    likeIcon.classList.remove('text-red-500');
                    likeIcon.classList.add('text-white');
                }

            } catch (error) {
                console.error('Une erreur s\'est produite pendant le processus d\'identification:', error);
                alert('Une erreur sest produite, veuillez vÃ©rifier la console.');
            } finally {
                // Ä°ÅŸlem bittiÄŸinde butonu tekrar aktif et
                likeButton.disabled = false;
            }
        });
    }
});

</script>


{% endblock %}
